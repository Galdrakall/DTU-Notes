---
title: "Week 4 Notes – Block Ciphers & Modes"
week: 4
course: "Cryptography Fundamentals"
tags: [cryptography, course/cryptography, week/4, block-ciphers]
links:
  index: "[[Cryptography Fundamentals]]"
  prev: "[[Week_3_Notes]]"
  next: "[[Week_5_Notes]]"
---

# Week 4 – Block Ciphers & Modes of Operation

> Index: [[Cryptography Fundamentals]]  
> Previous: [[Week_3_Notes]] · Next: [[Week_5_Notes]]

## AES overview

AES (Advanced Encryption Standard) is a widely deployed **block cipher**:

- Block size: 128 bits.
- Key sizes: 128, 192, or 256 bits.
- It is a family of permutations $\{ E_k \}$ on 128-bit blocks, with efficient inverse $D_k$.

Conceptually, AES is a PRP: for each key $k$, $E_k(\cdot)$ is a permutation on 128-bit blocks that *looks random* to an adversary without the key.

---

## SubBytes, ShiftRows, MixColumns

AES round structure (for AES-128):

- Initial AddRoundKey
- 9 “full” rounds + 1 final round (without MixColumns).

Within each full round:

1. **SubBytes** – non-linear substitution via an S-box applied to each byte.
2. **ShiftRows** – cyclic row shifts in the 4×4 byte state.
3. **MixColumns** – linear mixing of each column using matrix multiplication in a finite field.
4. **AddRoundKey** – XOR with round key derived from main key.

Purpose:

- SubBytes: introduces **non-linearity** (confusion).
- ShiftRows + MixColumns: provide **diffusion**: each bit of the input influences many bits of the output.
- AddRoundKey: injects the secret key material.

Security of AES relies on its round structure and the difficulty of any efficient cryptanalysis (no known practical attack for full AES with good keys).

---

## ECB (why not to use it)

**Electronic Codebook (ECB)** mode:

- For block cipher $E_k$, encrypt message blocks independently:

$$
c_i = E_k(m_i)
$$

Problems:

- **Deterministic**: identical plaintext blocks $\rightarrow$ identical ciphertext blocks.
- Leaks patterns; images encrypted in ECB still show outlines.
- Does **not** achieve IND-CPA security.

ECB is insecure for almost all real-world uses and should be avoided.

---

## CBC mode

**Cipher Block Chaining (CBC)** mode:

- Use an initialization vector (IV) $IV$ (random and unique).
- Encryption:

$$
c_0 = IV \\
c_i = E_k(m_i \oplus c_{i-1}) \quad \text{for } i \ge 1
$$

- Decryption:

$$
m_i = D_k(c_i) \oplus c_{i-1}
$$

Properties:

- Same plaintext block in different positions $\rightarrow$ different ciphertext (because previous ciphertext influences it).
- Requires **random IV** that is never reused with the same key for two different messages.
- With a secure PRP and proper IV handling, CBC provides IND-CPA security.

Pitfalls:

- IV must be unpredictable (or at least unique, depending on exact security notions).
- Padding must be handled securely (to avoid padding oracle attacks).

---

## CTR mode

**Counter (CTR)** mode turns a block cipher into a stream cipher:

- Choose a nonce $N$ and counter $ctr$.
- For block index $i$:

$$
\text{keystream}_i = E_k(N \parallel i), \quad
c_i = m_i \oplus \text{keystream}_i
$$

Decryption:

$$
m_i = c_i \oplus \text{keystream}_i.
$$

Properties:

- Parallelizable (unlike CBC encryption).
- Works like a one-time pad with keystream generated by AES.
- Requires **unique (nonce, counter)** pairs under the same key.

If AES is a secure PRP, CTR mode yields IND-CPA secure encryption.

---

## Nonce reuse attacks

A **nonce** is a value used once (e.g., IV in CTR, CBC, or other modes). Reusing nonces breaks security:

### CTR nonce reuse

If the same nonce and key are used for two messages $m$ and $m'$:

$$
c = m \oplus \text{keystream} \\
c' = m' \oplus \text{keystream} \\
\Rightarrow c \oplus c' = m \oplus m'.
$$

The XOR of ciphertexts reveals the XOR of messages $\rightarrow$ a lot of information leaks.

### CBC IV reuse

- Reusing IV with CBC + same key doesn’t reveal XOR of plaintexts as directly as CTR, but can still leak information and break some security guarantees, especially if IV is predictable.

Rule:

- Nonces/IVs must never repeat for the same key.
- Often: choose random 96/128-bit nonces to make collisions astronomically unlikely.
